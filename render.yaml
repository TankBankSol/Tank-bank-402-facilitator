services:
  # Facilitator Service
  - type: web
    name: x402-facilitator
    runtime: node
    plan: free
    buildCommand: npm ci && npm run build
    startCommand: npm run start:facilitator
    domains:
      - facilitator.tankbank.app
    envVars:
      - key: NODE_ENV
        value: production
      - key: FACILITATOR_PORT
        value: 3001
      - key: FACILITATOR_PRIVATE_KEY
        sync: false  # Set this in Render dashboard
      - key: FACILITATOR_PUBLIC_KEY
        sync: false  # Set this in Render dashboard
      - key: SOLANA_RPC_URL
        sync: false  # Set this in Render dashboard
      - key: SOLANA_WS_URL
        sync: false  # Set this in Render dashboard
      - key: SOLANA_NETWORK
        value: mainnet-beta
      - key: SIMULATE_TRANSACTIONS
        value: false
      - key: MAX_PAYMENT_AMOUNT
        value: 1000000000
      - key: DATABASE_PATH
        value: ./src/facilitator/nonce.db
      - key: NONCE_EXPIRY_HOURS
        value: 24
      - key: CLEANUP_INTERVAL_HOURS
        value: 1
      - key: PREMIUM_DATA_AMOUNT
        value: 100000
      - key: GENERATE_CONTENT_AMOUNT
        value: 50000
      - key: DOWNLOAD_FILE_AMOUNT
        value: 200000
      - key: TIER_ACCESS_AMOUNT
        value: 500000

  # Server Service
  - type: web
    name: x402-server
    runtime: node
    plan: free
    buildCommand: npm ci && npm run build
    startCommand: npm run start:server
    domains:
      - api.tankbank.app
    envVars:
      - key: NODE_ENV
        value: production
      - key: SERVER_PORT
        value: 3000
      - key: SERVER_URL
        value: https://api.tankbank.app
      - key: FACILITATOR_URL
        value: https://facilitator.tankbank.app
      - key: MERCHANT_SOLANA_ADDRESS
        sync: false  # Set this in Render dashboard
      - key: DEVELOPER_WALLET_ADDRESS
        sync: false  # Optional: Set developer wallet for 60% revenue share
      - key: SOLANA_RPC_URL
        sync: false  # Set this in Render dashboard
      - key: SOLANA_WS_URL
        sync: false  # Set this in Render dashboard
      - key: SOLANA_NETWORK
        value: mainnet-beta
      - key: REQUEST_TIMEOUT
        value: 30000
      - key: RETRY_ATTEMPTS
        value: 3
      - key: RETRY_DELAY
        value: 1000
      - key: REQUEST_BODY_LIMIT
        value: 10mb
      - key: PREMIUM_DATA_AMOUNT
        value: 100000
      - key: GENERATE_CONTENT_AMOUNT
        value: 50000
      - key: DOWNLOAD_FILE_AMOUNT
        value: 200000
      - key: TIER_ACCESS_AMOUNT
        value: 500000