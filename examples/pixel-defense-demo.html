<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Defense - Tank Bank x402 Integration Demo</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
            color: #00ff00;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-bottom: 2px solid #00ff00;
        }

        .header h1 {
            margin: 0;
            font-size: 36px;
            text-shadow: 0 0 15px #00ff00;
        }

        .header p {
            margin: 10px 0 0 0;
            opacity: 0.8;
            font-size: 14px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .demo-section {
            background: rgba(0, 255, 0, 0.05);
            border: 1px solid #00ff00;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
        }

        .wallet-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .status-indicator {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 12px;
        }

        .status-connected {
            background: #00ff00;
            color: #000;
        }

        .status-disconnected {
            background: #ff4444;
            color: #fff;
        }

        .game-container {
            width: 100%;
            height: 600px;
            border: 2px solid #00ff00;
            border-radius: 10px;
            background: #000;
            position: relative;
            overflow: hidden;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(45deg, #00ff00, #00cc00);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-transform: uppercase;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }

        button:disabled {
            background: #666;
            color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .danger-btn {
            background: linear-gradient(45deg, #ff4444, #cc0000) !important;
            color: white !important;
        }

        .info-panel {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 8px;
            background: rgba(0, 255, 0, 0.1);
            border-radius: 4px;
        }

        .log-console {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border: 1px solid #00ff00;
            margin-top: 20px;
        }

        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }

        .log-error {
            color: #ff4444;
        }

        .log-success {
            color: #00ff00;
        }

        .log-info {
            color: #ffff00;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõ°Ô∏è PIXEL DEFENSE üõ°Ô∏è</h1>
        <p>Tank Bank x402 Gaming SDK Integration Demo</p>
    </div>

    <div class="container">
        <!-- Wallet Connection Section -->
        <div class="demo-section">
            <h2>üí≥ Wallet Connection</h2>
            <div class="wallet-status">
                <div>
                    <strong>Wallet Status:</strong>
                    <span id="wallet-status" class="status-indicator status-disconnected">Disconnected</span>
                </div>
                <div id="wallet-address" style="font-family: monospace; font-size: 12px;">
                    No wallet connected
                </div>
            </div>
            <div class="controls">
                <button id="connect-wallet" onclick="connectWallet()">üîó Connect Wallet</button>
                <button id="disconnect-wallet" onclick="disconnectWallet()" disabled>üö™ Disconnect</button>
                <button id="check-balance" onclick="checkBalance()" disabled>üí∞ Check Balance</button>
            </div>
        </div>

        <!-- Game Information Section -->
        <div class="demo-section">
            <h2>üéÆ Game Information</h2>
            <div class="info-panel">
                <div class="info-item">
                    <span>Game Name:</span>
                    <span>Pixel Defense</span>
                </div>
                <div class="info-item">
                    <span>Cost to Play:</span>
                    <span id="game-cost">0.01 SOL</span>
                </div>
                <div class="info-item">
                    <span>Network:</span>
                    <span>Solana Devnet</span>
                </div>
                <div class="info-item">
                    <span>Session Status:</span>
                    <span id="session-status">No active session</span>
                </div>
            </div>
            <div class="controls">
                <button id="start-game" onclick="startGame()" disabled>üöÄ Start Game</button>
                <button id="end-game" onclick="endGame()" disabled>üõë End Game</button>
                <button id="check-session" onclick="checkSession()" disabled>üìä Check Session</button>
            </div>
        </div>

        <!-- Game Container -->
        <div class="demo-section">
            <h2>üéØ Game Area</h2>
            <div id="game-container" class="game-container">
                <div style="display: flex; justify-content: center; align-items: center; height: 100%; text-align: center; flex-direction: column;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üõ°Ô∏è</div>
                    <h3>Pixel Defense</h3>
                    <p>Connect your wallet and start playing!</p>
                    <small style="opacity: 0.7;">Game will load here after payment confirmation</small>
                </div>
            </div>
        </div>

        <!-- Console Log -->
        <div class="demo-section">
            <h2>üìã Console Log</h2>
            <div id="log-console" class="log-console">
                <div class="log-entry log-info">[INFO] Pixel Defense Demo initialized</div>
                <div class="log-entry log-info">[INFO] Connect your wallet to begin</div>
            </div>
        </div>
    </div>

    <!-- Include Solana Wallet Adapter -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>

    <script>
        // Demo state
        let pixelDefenseIntegration = null;
        let mockWallet = null;

        // Configuration (you would customize these)
        const DEMO_CONFIG = {
            gameUrl: 'https://example.com/pixel-defense-game', // Replace with actual game URL
            costToPlay: 10000000, // 0.01 SOL in lamports
            facilitatorUrl: 'http://localhost:3001', // Your facilitator URL
            merchantAddress: '23sKDzoiE6iZUoaNFRCJrgaxZB6dp1a4tjZGTo3VCb7r', // Your merchant address
            network: 'devnet',
            rpcUrl: 'https://api.devnet.solana.com'
        };

        // Logging utility
        function log(message, type = 'info') {
            const console = document.getElementById('log-console');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] [${type.toUpperCase()}] ${message}`;
            console.appendChild(entry);
            console.scrollTop = console.scrollHeight;
        }

        // Mock wallet for demo purposes
        class MockWallet {
            constructor() {
                this.connected = false;
                this.publicKey = null;
            }

            async connect() {
                log('Connecting to mock wallet...', 'info');
                // Simulate wallet connection
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Generate a mock public key
                this.publicKey = new solanaWeb3.PublicKey('11111111111111111111111111111112');
                this.connected = true;
                log('Mock wallet connected successfully', 'success');
                return { publicKey: this.publicKey };
            }

            async disconnect() {
                this.connected = false;
                this.publicKey = null;
                log('Wallet disconnected', 'info');
            }

            async signMessage(message) {
                log('Signing message with mock wallet...', 'info');
                // Return a mock signature
                return new Uint8Array(64).fill(1);
            }
        }

        // Initialize the demo
        async function initDemo() {
            try {
                log('Initializing Pixel Defense integration...', 'info');

                // Note: In a real implementation, you would import the actual SDK
                // For this demo, we're showing the structure

                log('Demo ready - connect your wallet to start', 'success');
            } catch (error) {
                log(`Initialization error: ${error.message}`, 'error');
            }
        }

        // Wallet functions
        async function connectWallet() {
            try {
                log('Attempting to connect wallet...', 'info');

                // Create mock wallet for demo
                mockWallet = new MockWallet();
                await mockWallet.connect();

                // Update UI
                document.getElementById('wallet-status').textContent = 'Connected';
                document.getElementById('wallet-status').className = 'status-indicator status-connected';
                document.getElementById('wallet-address').textContent = mockWallet.publicKey.toString();

                // Enable buttons
                document.getElementById('connect-wallet').disabled = true;
                document.getElementById('disconnect-wallet').disabled = false;
                document.getElementById('check-balance').disabled = false;
                document.getElementById('start-game').disabled = false;
                document.getElementById('check-session').disabled = false;

                log('Wallet connected successfully', 'success');

            } catch (error) {
                log(`Wallet connection failed: ${error.message}`, 'error');
            }
        }

        async function disconnectWallet() {
            try {
                if (mockWallet) {
                    await mockWallet.disconnect();
                }

                // Update UI
                document.getElementById('wallet-status').textContent = 'Disconnected';
                document.getElementById('wallet-status').className = 'status-indicator status-disconnected';
                document.getElementById('wallet-address').textContent = 'No wallet connected';

                // Disable buttons
                document.getElementById('connect-wallet').disabled = false;
                document.getElementById('disconnect-wallet').disabled = true;
                document.getElementById('check-balance').disabled = true;
                document.getElementById('start-game').disabled = true;
                document.getElementById('check-session').disabled = true;
                document.getElementById('end-game').disabled = true;

                log('Wallet disconnected', 'info');

            } catch (error) {
                log(`Disconnect error: ${error.message}`, 'error');
            }
        }

        async function checkBalance() {
            try {
                log('Checking wallet balance...', 'info');

                // Mock balance check
                const mockBalance = 50000000; // 0.05 SOL
                const solBalance = (mockBalance / 1e9).toFixed(4);
                const canPlay = mockBalance >= DEMO_CONFIG.costToPlay;

                log(`Current balance: ${solBalance} SOL`, 'info');

                if (canPlay) {
                    log('‚úÖ Sufficient balance to play Pixel Defense', 'success');
                } else {
                    const required = (DEMO_CONFIG.costToPlay / 1e9).toFixed(4);
                    log(`‚ùå Insufficient balance. Required: ${required} SOL`, 'error');
                }

            } catch (error) {
                log(`Balance check failed: ${error.message}`, 'error');
            }
        }

        // Game functions
        async function startGame() {
            try {
                log('Starting Pixel Defense game...', 'info');

                // Show custom confirmation modal
                const confirmed = await showGameConfirmation();
                if (!confirmed) {
                    log('Game start cancelled by user', 'info');
                    return;
                }

                log('Payment confirmed, starting game session...', 'success');

                // Mock game loading
                const gameContainer = document.getElementById('game-container');
                gameContainer.innerHTML = `
                    <div style="display: flex; justify-content: center; align-items: center; height: 100%; flex-direction: column; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);">
                        <div style="font-size: 48px; margin-bottom: 20px;">üõ°Ô∏è</div>
                        <h2 style="color: #00ff00; text-shadow: 0 0 10px #00ff00;">PIXEL DEFENSE ACTIVE</h2>
                        <div style="margin: 20px 0; padding: 15px; background: rgba(0, 255, 0, 0.1); border: 1px solid #00ff00; border-radius: 8px;">
                            <p style="margin: 0; color: #ffff00;">üéÆ Game Session Active</p>
                            <p style="margin: 5px 0 0 0; font-size: 12px; opacity: 0.8;">Session ID: demo_${Date.now()}</p>
                        </div>
                        <p style="color: #00ff00; opacity: 0.8;">Your towers are ready, Commander!</p>
                        <small style="opacity: 0.6;">In a real implementation, the game would load here</small>
                    </div>
                `;

                // Update session status
                document.getElementById('session-status').textContent = 'Active Session';
                document.getElementById('end-game').disabled = false;

                log('Game session started successfully', 'success');
                log('Session ID: demo_' + Date.now(), 'info');

            } catch (error) {
                log(`Failed to start game: ${error.message}`, 'error');
            }
        }

        async function endGame() {
            try {
                log('Ending game session...', 'info');

                const gameContainer = document.getElementById('game-container');
                gameContainer.innerHTML = `
                    <div style="display: flex; justify-content: center; align-items: center; height: 100%; text-align: center; flex-direction: column;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üèÜ</div>
                        <h3 style="color: #ffff00;">Game Ended</h3>
                        <p>Thank you for playing Pixel Defense!</p>
                        <small style="opacity: 0.7;">Connect wallet and start a new game</small>
                    </div>
                `;

                document.getElementById('session-status').textContent = 'No active session';
                document.getElementById('end-game').disabled = true;

                log('Game session ended', 'success');

            } catch (error) {
                log(`Failed to end game: ${error.message}`, 'error');
            }
        }

        async function checkSession() {
            try {
                log('Checking game session...', 'info');

                // Mock session check
                const hasActiveSession = !document.getElementById('end-game').disabled;

                if (hasActiveSession) {
                    log('‚úÖ Active game session found', 'success');
                    log('Session details: Player engaged in tower defense', 'info');
                } else {
                    log('‚ùå No active game session', 'info');
                }

            } catch (error) {
                log(`Session check failed: ${error.message}`, 'error');
            }
        }

        // Custom confirmation modal
        function showGameConfirmation() {
            return new Promise((resolve) => {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.9);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    font-family: 'Courier New', monospace;
                `;

                const content = document.createElement('div');
                content.style.cssText = `
                    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                    border: 2px solid #00ff00;
                    padding: 40px;
                    border-radius: 15px;
                    max-width: 500px;
                    text-align: center;
                    box-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
                    color: #00ff00;
                `;

                const solAmount = (DEMO_CONFIG.costToPlay / 1e9).toFixed(4);

                content.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <h1 style="margin: 0; font-size: 28px; text-shadow: 0 0 10px #00ff00;">üõ°Ô∏è PIXEL DEFENSE üõ°Ô∏è</h1>
                        <div style="margin: 10px 0; height: 2px; background: #00ff00; opacity: 0.7;"></div>
                    </div>

                    <div style="margin: 30px 0; padding: 20px; background: rgba(0, 255, 0, 0.1); border: 1px solid #00ff00; border-radius: 8px;">
                        <h2 style="margin: 0 0 15px 0; color: #ffff00; text-shadow: 0 0 5px #ffff00;">‚ö° PAYMENT REQUIRED ‚ö°</h2>
                        <div style="font-size: 24px; font-weight: bold; margin: 10px 0; text-shadow: 0 0 8px #00ff00;">${solAmount} SOL</div>
                        <div style="font-size: 14px; opacity: 0.8;">Defend your base ‚Ä¢ Earn rewards ‚Ä¢ Climb leaderboards</div>
                    </div>

                    <div style="margin: 20px 0; font-size: 14px; opacity: 0.9; line-height: 1.5;">
                        <p>üéØ Tower Defense Action</p>
                        <p>üí∞ Play-to-Earn Rewards</p>
                        <p>üèÜ Global Leaderboards</p>
                    </div>

                    <div style="margin-top: 30px;">
                        <button id="confirm-btn" style="
                            background: linear-gradient(45deg, #00ff00, #00cc00);
                            color: #000;
                            border: none;
                            padding: 15px 30px;
                            margin: 0 10px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 16px;
                            font-weight: bold;
                            font-family: 'Courier New', monospace;
                            text-transform: uppercase;
                            box-shadow: 0 0 15px rgba(0, 255, 0, 0.4);
                        ">üöÄ Start Defense</button>
                        <button id="cancel-btn" style="
                            background: linear-gradient(45deg, #ff4444, #cc0000);
                            color: white;
                            border: none;
                            padding: 15px 30px;
                            margin: 0 10px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 16px;
                            font-family: 'Courier New', monospace;
                            text-transform: uppercase;
                            box-shadow: 0 0 15px rgba(255, 68, 68, 0.4);
                        ">‚úñÔ∏è Cancel</button>
                    </div>

                    <div style="margin-top: 20px; font-size: 11px; opacity: 0.6;">Powered by Tank Bank x402 Protocol</div>
                `;

                modal.appendChild(content);
                document.body.appendChild(modal);

                const confirmBtn = content.querySelector('#confirm-btn');
                const cancelBtn = content.querySelector('#cancel-btn');

                confirmBtn.addEventListener('click', () => {
                    document.body.removeChild(modal);
                    resolve(true);
                });

                cancelBtn.addEventListener('click', () => {
                    document.body.removeChild(modal);
                    resolve(false);
                });

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                        resolve(false);
                    }
                });
            });
        }

        // Initialize demo when page loads
        document.addEventListener('DOMContentLoaded', initDemo);
    </script>
</body>
</html>